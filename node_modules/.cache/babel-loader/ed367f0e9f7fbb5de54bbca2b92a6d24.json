{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Polling = void 0;\n\nconst transport_js_1 = require(\"../transport.js\");\n\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\n\n\nconst yeast_1 = __importDefault(require(\"yeast\"));\n\nconst parseqs_1 = __importDefault(require(\"parseqs\"));\n\nconst engine_io_parser_1 = require(\"engine.io-parser\");\n\nconst debug = (0, debug_1.default)(\"engine.io-client:polling\"); // debug()\n\nclass Polling extends transport_js_1.Transport {\n  constructor() {\n    super(...arguments);\n    this.polling = false;\n  }\n  /**\r\n   * Transport name.\r\n   */\n\n\n  get name() {\n    return \"polling\";\n  }\n  /**\r\n   * Opens the socket (triggers polling). We write a PING message to determine\r\n   * when the transport is open.\r\n   *\r\n   * @api private\r\n   */\n\n\n  doOpen() {\n    this.poll();\n  }\n  /**\r\n   * Pauses polling.\r\n   *\r\n   * @param {Function} callback upon buffers are flushed and transport is paused\r\n   * @api private\r\n   */\n\n\n  pause(onPause) {\n    this.readyState = \"pausing\";\n\n    const pause = () => {\n      debug(\"paused\");\n      this.readyState = \"paused\";\n      onPause();\n    };\n\n    if (this.polling || !this.writable) {\n      let total = 0;\n\n      if (this.polling) {\n        debug(\"we are currently polling - waiting to pause\");\n        total++;\n        this.once(\"pollComplete\", function () {\n          debug(\"pre-pause polling complete\");\n          --total || pause();\n        });\n      }\n\n      if (!this.writable) {\n        debug(\"we are currently writing - waiting to pause\");\n        total++;\n        this.once(\"drain\", function () {\n          debug(\"pre-pause writing complete\");\n          --total || pause();\n        });\n      }\n    } else {\n      pause();\n    }\n  }\n  /**\r\n   * Starts polling cycle.\r\n   *\r\n   * @api public\r\n   */\n\n\n  poll() {\n    debug(\"polling\");\n    this.polling = true;\n    this.doPoll();\n    this.emit(\"poll\");\n  }\n  /**\r\n   * Overloads onData to detect payloads.\r\n   *\r\n   * @api private\r\n   */\n\n\n  onData(data) {\n    debug(\"polling got data %s\", data);\n\n    const callback = packet => {\n      // if its the first message we consider the transport open\n      if (\"opening\" === this.readyState && packet.type === \"open\") {\n        this.onOpen();\n      } // if its a close packet, we close the ongoing requests\n\n\n      if (\"close\" === packet.type) {\n        this.onClose();\n        return false;\n      } // otherwise bypass onData and handle the message\n\n\n      this.onPacket(packet);\n    }; // decode payload\n\n\n    (0, engine_io_parser_1.decodePayload)(data, this.socket.binaryType).forEach(callback); // if an event did not trigger closing\n\n    if (\"closed\" !== this.readyState) {\n      // if we got data we're not polling\n      this.polling = false;\n      this.emit(\"pollComplete\");\n\n      if (\"open\" === this.readyState) {\n        this.poll();\n      } else {\n        debug('ignoring poll - transport state \"%s\"', this.readyState);\n      }\n    }\n  }\n  /**\r\n   * For polling, send a close packet.\r\n   *\r\n   * @api private\r\n   */\n\n\n  doClose() {\n    const close = () => {\n      debug(\"writing close packet\");\n      this.write([{\n        type: \"close\"\n      }]);\n    };\n\n    if (\"open\" === this.readyState) {\n      debug(\"transport open - closing\");\n      close();\n    } else {\n      // in case we're trying to close while\n      // handshaking is in progress (GH-164)\n      debug(\"transport not open - deferring close\");\n      this.once(\"open\", close);\n    }\n  }\n  /**\r\n   * Writes a packets payload.\r\n   *\r\n   * @param {Array} data packets\r\n   * @param {Function} drain callback\r\n   * @api private\r\n   */\n\n\n  write(packets) {\n    this.writable = false;\n    (0, engine_io_parser_1.encodePayload)(packets, data => {\n      this.doWrite(data, () => {\n        this.writable = true;\n        this.emit(\"drain\");\n      });\n    });\n  }\n  /**\r\n   * Generates uri for connection.\r\n   *\r\n   * @api private\r\n   */\n\n\n  uri() {\n    let query = this.query || {};\n    const schema = this.opts.secure ? \"https\" : \"http\";\n    let port = \"\"; // cache busting is forced\n\n    if (false !== this.opts.timestampRequests) {\n      query[this.opts.timestampParam] = (0, yeast_1.default)();\n    }\n\n    if (!this.supportsBinary && !query.sid) {\n      query.b64 = 1;\n    } // avoid port if default for schema\n\n\n    if (this.opts.port && (\"https\" === schema && Number(this.opts.port) !== 443 || \"http\" === schema && Number(this.opts.port) !== 80)) {\n      port = \":\" + this.opts.port;\n    }\n\n    const encodedQuery = parseqs_1.default.encode(query);\n    const ipv6 = this.opts.hostname.indexOf(\":\") !== -1;\n    return schema + \"://\" + (ipv6 ? \"[\" + this.opts.hostname + \"]\" : this.opts.hostname) + port + this.opts.path + (encodedQuery.length ? \"?\" + encodedQuery : \"\");\n  }\n\n}\n\nexports.Polling = Polling;","map":{"version":3,"sources":["C:/Workspace/Skull-King-React/node_modules/engine.io-client/build/cjs/transports/polling.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","Polling","transport_js_1","require","debug_1","yeast_1","parseqs_1","engine_io_parser_1","debug","default","Transport","constructor","arguments","polling","name","doOpen","poll","pause","onPause","readyState","writable","total","once","doPoll","emit","onData","data","callback","packet","type","onOpen","onClose","onPacket","decodePayload","socket","binaryType","forEach","doClose","close","write","packets","encodePayload","doWrite","uri","query","schema","opts","secure","port","timestampRequests","timestampParam","supportsBinary","sid","b64","Number","encodedQuery","encode","ipv6","hostname","indexOf","path","length"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Polling = void 0;\r\nconst transport_js_1 = require(\"../transport.js\");\r\nconst debug_1 = __importDefault(require(\"debug\")); // debug()\r\nconst yeast_1 = __importDefault(require(\"yeast\"));\r\nconst parseqs_1 = __importDefault(require(\"parseqs\"));\r\nconst engine_io_parser_1 = require(\"engine.io-parser\");\r\nconst debug = (0, debug_1.default)(\"engine.io-client:polling\"); // debug()\r\nclass Polling extends transport_js_1.Transport {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.polling = false;\r\n    }\r\n    /**\r\n     * Transport name.\r\n     */\r\n    get name() {\r\n        return \"polling\";\r\n    }\r\n    /**\r\n     * Opens the socket (triggers polling). We write a PING message to determine\r\n     * when the transport is open.\r\n     *\r\n     * @api private\r\n     */\r\n    doOpen() {\r\n        this.poll();\r\n    }\r\n    /**\r\n     * Pauses polling.\r\n     *\r\n     * @param {Function} callback upon buffers are flushed and transport is paused\r\n     * @api private\r\n     */\r\n    pause(onPause) {\r\n        this.readyState = \"pausing\";\r\n        const pause = () => {\r\n            debug(\"paused\");\r\n            this.readyState = \"paused\";\r\n            onPause();\r\n        };\r\n        if (this.polling || !this.writable) {\r\n            let total = 0;\r\n            if (this.polling) {\r\n                debug(\"we are currently polling - waiting to pause\");\r\n                total++;\r\n                this.once(\"pollComplete\", function () {\r\n                    debug(\"pre-pause polling complete\");\r\n                    --total || pause();\r\n                });\r\n            }\r\n            if (!this.writable) {\r\n                debug(\"we are currently writing - waiting to pause\");\r\n                total++;\r\n                this.once(\"drain\", function () {\r\n                    debug(\"pre-pause writing complete\");\r\n                    --total || pause();\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            pause();\r\n        }\r\n    }\r\n    /**\r\n     * Starts polling cycle.\r\n     *\r\n     * @api public\r\n     */\r\n    poll() {\r\n        debug(\"polling\");\r\n        this.polling = true;\r\n        this.doPoll();\r\n        this.emit(\"poll\");\r\n    }\r\n    /**\r\n     * Overloads onData to detect payloads.\r\n     *\r\n     * @api private\r\n     */\r\n    onData(data) {\r\n        debug(\"polling got data %s\", data);\r\n        const callback = packet => {\r\n            // if its the first message we consider the transport open\r\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\r\n                this.onOpen();\r\n            }\r\n            // if its a close packet, we close the ongoing requests\r\n            if (\"close\" === packet.type) {\r\n                this.onClose();\r\n                return false;\r\n            }\r\n            // otherwise bypass onData and handle the message\r\n            this.onPacket(packet);\r\n        };\r\n        // decode payload\r\n        (0, engine_io_parser_1.decodePayload)(data, this.socket.binaryType).forEach(callback);\r\n        // if an event did not trigger closing\r\n        if (\"closed\" !== this.readyState) {\r\n            // if we got data we're not polling\r\n            this.polling = false;\r\n            this.emit(\"pollComplete\");\r\n            if (\"open\" === this.readyState) {\r\n                this.poll();\r\n            }\r\n            else {\r\n                debug('ignoring poll - transport state \"%s\"', this.readyState);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * For polling, send a close packet.\r\n     *\r\n     * @api private\r\n     */\r\n    doClose() {\r\n        const close = () => {\r\n            debug(\"writing close packet\");\r\n            this.write([{ type: \"close\" }]);\r\n        };\r\n        if (\"open\" === this.readyState) {\r\n            debug(\"transport open - closing\");\r\n            close();\r\n        }\r\n        else {\r\n            // in case we're trying to close while\r\n            // handshaking is in progress (GH-164)\r\n            debug(\"transport not open - deferring close\");\r\n            this.once(\"open\", close);\r\n        }\r\n    }\r\n    /**\r\n     * Writes a packets payload.\r\n     *\r\n     * @param {Array} data packets\r\n     * @param {Function} drain callback\r\n     * @api private\r\n     */\r\n    write(packets) {\r\n        this.writable = false;\r\n        (0, engine_io_parser_1.encodePayload)(packets, data => {\r\n            this.doWrite(data, () => {\r\n                this.writable = true;\r\n                this.emit(\"drain\");\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * Generates uri for connection.\r\n     *\r\n     * @api private\r\n     */\r\n    uri() {\r\n        let query = this.query || {};\r\n        const schema = this.opts.secure ? \"https\" : \"http\";\r\n        let port = \"\";\r\n        // cache busting is forced\r\n        if (false !== this.opts.timestampRequests) {\r\n            query[this.opts.timestampParam] = (0, yeast_1.default)();\r\n        }\r\n        if (!this.supportsBinary && !query.sid) {\r\n            query.b64 = 1;\r\n        }\r\n        // avoid port if default for schema\r\n        if (this.opts.port &&\r\n            ((\"https\" === schema && Number(this.opts.port) !== 443) ||\r\n                (\"http\" === schema && Number(this.opts.port) !== 80))) {\r\n            port = \":\" + this.opts.port;\r\n        }\r\n        const encodedQuery = parseqs_1.default.encode(query);\r\n        const ipv6 = this.opts.hostname.indexOf(\":\") !== -1;\r\n        return (schema +\r\n            \"://\" +\r\n            (ipv6 ? \"[\" + this.opts.hostname + \"]\" : this.opts.hostname) +\r\n            port +\r\n            this.opts.path +\r\n            (encodedQuery.length ? \"?\" + encodedQuery : \"\"));\r\n    }\r\n}\r\nexports.Polling = Polling;\r\n"]},"metadata":{},"sourceType":"script"}